#!/usr/bin/env bash
# Relatรณrio pรณs-instalaรงรฃo - Layout 2 colunas

get_version() {
  local cmd="$1"
  case "$cmd" in
    git) git --version 2>&1 | awk '{print $3}' ;;
    zsh) zsh --version 2>&1 | awk '{print $2}' ;;
    fish) fish --version 2>&1 | awk '{print $3}' ;;
    tmux) tmux -V 2>&1 | awk '{print $2}' ;;
    nvim) nvim --version 2>&1 | head -n 1 | awk '{print $2}' ;;
    starship) starship --version 2>/dev/null | head -n 1 | awk '{print $2}' ;;
    mise) mise --version 2>/dev/null | head -n 1 | awk '{print $1}' ;;
    code) code --version 2>&1 | head -n 1 ;;
    docker) docker --version 2>&1 | awk '{print $3}' | tr -d ',' ;;
    node) node --version 2>/dev/null ;;
    python) python3 --version 2>/dev/null | awk '{print $2}' ;;
    php) php --version 2>/dev/null | head -n 1 | awk '{print $2}' ;;
    rust) rustc --version 2>/dev/null | awk '{print $2}' ;;
    go) go version 2>/dev/null | awk '{print $3}' | sed 's/go//' ;;
    bun) bun --version 2>/dev/null ;;
    deno) deno --version 2>/dev/null | head -n 1 | awk '{print $2}' ;;
  esac
}

print_post_install_report() {
  local username="${USER:-$(whoami)}"
  local hostname="${HOSTNAME:-$(hostname 2>/dev/null || echo 'localhost')}"

  # Cores
  local RED='\033[0;31m'
  local GREEN='\033[0;32m'
  local YELLOW='\033[1;33m'
  local BLUE='\033[0;34m'
  local PURPLE='\033[0;35m'
  local CYAN='\033[0;36m'
  local WHITE='\033[1;37m'
  local NC='\033[0m'

  [[ -t 1 ]] && clear

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # HEADER
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  echo ""
  echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo -e "${GREEN}โ${NC}                    ${YELLOW}โจ INSTALAรรO CONCLUรDA COM SUCESSO! โจ${NC}                    ${GREEN}โ${NC}"
  echo -e "${GREEN}โ${NC}                      ${WHITE}Seu ambiente de desenvolvimento estรก pronto${NC}                   ${GREEN}โ${NC}"
  echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo ""

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # INFORMAรรES DO SISTEMA (compacto)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  echo -e "${BLUE}๐ INFORMAรรES DA INSTALAรรO${NC}"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo -e "${CYAN}โ${NC} ${WHITE}๐ค Usuรกrio:${NC} $username          ${WHITE}๐ฅ๏ธ  Host:${NC} $hostname          ${WHITE}๐ง OS:${NC} ${TARGET_OS:-linux}"
  echo -e "${CYAN}โ${NC} ${WHITE}๐ Origem:${NC}  ${SCRIPT_DIR:-$(cd "$(dirname "$0")" && pwd)}"
  echo -e "${CYAN}โ${NC} ${WHITE}๐ Destino:${NC} $HOME"
  [[ -d "$BACKUP_DIR" ]] && echo -e "${CYAN}โ${NC} ${WHITE}๐ฆ Backup:${NC}  $BACKUP_DIR"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo ""

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # FERRAMENTAS INSTALADAS (2 colunas)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  echo -e "${PURPLE}๐๏ธ  FERRAMENTAS INSTALADAS${NC}"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"

  # Coletar ferramentas
  local col1=() col2=()
  has_cmd git && col1+=("๐ Git: $(get_version git)")
  has_cmd zsh && col1+=("๐ Zsh: $(get_version zsh)")
  has_cmd fish && col1+=("๐ Fish: $(get_version fish)")
  has_cmd tmux && col1+=("๐บ Tmux: $(get_version tmux)")
  has_cmd nvim && col1+=("๐ Neovim: $(get_version nvim)")

  has_cmd starship && col2+=("๐ Starship: $(get_version starship)")
  has_cmd code && col2+=("๐ป VS Code: $(get_version code)")
  has_cmd docker && col2+=("๐ณ Docker: $(get_version docker)")
  has_cmd mise && col2+=("๐ฆ Mise: $(get_version mise)")

  local max=${#col1[@]}
  [[ ${#col2[@]} -gt $max ]] && max=${#col2[@]}

  for (( i=0; i<max; i++ )); do
    local left="${col1[i]:-}"
    local right="${col2[i]:-}"
    printf "${CYAN}โ${NC} ${WHITE}%-37s${NC} ${CYAN}โ${NC} ${WHITE}%-39s${NC} ${CYAN}โ${NC}\n" "$left" "$right"
  done

  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo ""

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # RUNTIMES (se houver, em 2 colunas)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  local rt_col1=() rt_col2=()

  if has_cmd node || has_cmd python3 || has_cmd php; then
    has_cmd node && rt_col1+=("๐ข Node.js: $(get_version node)")
    has_cmd python3 && rt_col1+=("๐ Python: $(get_version python)")
    has_cmd php && rt_col2+=("๐ PHP: $(get_version php)")
    has_cmd rustc && rt_col2+=("๐ฆ Rust: $(get_version rust)")
    has_cmd go && rt_col2+=("๐ท Go: $(get_version go)")
    has_cmd bun && rt_col2+=("๐ง Bun: $(get_version bun)")
    has_cmd deno && rt_col2+=("๐ฆ Deno: $(get_version deno)")

    echo -e "${YELLOW}๐ RUNTIMES DE DESENVOLVIMENTO${NC}"
    echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"

    local rt_max=${#rt_col1[@]}
    [[ ${#rt_col2[@]} -gt $rt_max ]] && rt_max=${#rt_col2[@]}

    for (( i=0; i<rt_max; i++ )); do
      local left="${rt_col1[i]:-}"
      local right="${rt_col2[i]:-}"
      printf "${CYAN}โ${NC} ${WHITE}%-37s${NC} ${CYAN}โ${NC} ${WHITE}%-39s${NC} ${CYAN}โ${NC}\n" "$left" "$right"
    done

    echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
    echo ""
  fi

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # PRรXIMOS PASSOS (lista vertical limpa)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  echo -e "${GREEN}โก PRรXIMOS PASSOS${NC}"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
  echo -e "${CYAN}โ${NC}  ${WHITE}1.${NC} Reinicie o terminal:              ${BLUE}exec \$SHELL${NC}                              ${CYAN}โ${NC}"
  if [[ ${INSTALL_POWERLEVEL10K:-0} -eq 1 ]]; then
    echo -e "${CYAN}โ${NC}  ${WHITE}2.${NC} Configure Powerlevel10k:          ${BLUE}p10k configure${NC}                           ${CYAN}โ${NC}"
  fi
  if [[ ${#SELECTED_NERD_FONTS[@]} -gt 0 ]]; then
    echo -e "${CYAN}โ${NC}  ${WHITE}3.${NC} Configure a fonte no terminal:    ${GREEN}${SELECTED_NERD_FONTS[0]} Nerd Font${NC}                    ${CYAN}โ${NC}"
  fi
  if [[ ${GIT_CONFIGURE:-0} -eq 1 ]]; then
    echo -e "${CYAN}โ${NC}  ${WHITE}4.${NC} Clone projetos nas pastas:        ${BLUE}~/personal/*${NC} ou ${BLUE}~/work/*${NC}                  ${CYAN}โ${NC}"
  fi
  echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo ""

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # COMANDOS รTEIS (lista vertical clara)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  echo -e "${YELLOW}๐ก COMANDOS รTEIS${NC}"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
  echo -e "${CYAN}โ${NC}  ${WHITE}bash install.sh export${NC}  โ  Salvar mudanรงas nos dotfiles                       ${CYAN}โ${NC}"
  echo -e "${CYAN}โ${NC}  ${WHITE}bash install.sh sync${NC}    โ  Sincronizar dotfiles (pull + install)              ${CYAN}โ${NC}"
  if has_cmd fzf; then
    echo -e "${CYAN}โ${NC}  ${WHITE}Ctrl+R${NC}                  โ  Buscar histรณrico com fzf                           ${CYAN}โ${NC}"
  fi
  if has_cmd lazygit; then
    echo -e "${CYAN}โ${NC}  ${WHITE}lazygit${NC}                 โ  Interface TUI para Git                             ${CYAN}โ${NC}"
  fi
  if has_cmd zoxide; then
    echo -e "${CYAN}โ${NC}  ${WHITE}z <pasta>${NC}               โ  Navegaรงรฃo inteligente (zoxide)                     ${CYAN}โ${NC}"
  fi
  echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
  echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
  echo ""

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # DICAS DO MISE (se instalado)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  if has_cmd mise; then
    echo -e "${PURPLE}๐ฆ MISE - GERENCIADOR DE RUNTIMES${NC}"
    echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
    echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${WHITE}mise ls${NC}                   โ  Listar runtimes instalados                        ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${WHITE}mise ls-remote node${NC}       โ  Ver versรตes disponรญveis do Node.js                ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${WHITE}mise use -g node@22${NC}       โ  Instalar e definir Node 22 como global            ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${WHITE}mise use node@20${NC}          โ  Usar Node 20 apenas no projeto atual              ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${WHITE}mise install${NC}              โ  Instalar versรตes definidas no .mise.toml          ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${WHITE}mise prune${NC}                โ  Remover versรตes nรฃo utilizadas                    ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}  ${BLUE}Exemplos:${NC}                                                                       ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}    mise use -g python@3.12     โ  Python 3.12 global                            ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}    mise use -g rust@stable     โ  Rust stable global                            ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}    mise use -g go@1.22         โ  Go 1.22 global                                ${CYAN}โ${NC}"
    echo -e "${CYAN}โ${NC}                                                                                 ${CYAN}โ${NC}"
    echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
    echo ""
  fi

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # FOOTER
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  echo -e "  ${BLUE}๐ Portfรณlio:${NC} https://lucassr.dev          ${GREEN}๐ฆ GitHub:${NC} https://github.com/lucassr-dev/.config"
  echo ""
}
